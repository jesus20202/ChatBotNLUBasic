ğŸ¤– PROMPT COMPLETO - Chat IA con Recomendaciones para DataBot
ğŸ“‹ CONTEXTO DEL PROYECTO
Objetivo: Desarrollar un chat en tiempo real con IA que consulte base de datos para recomendaciones y categorizaciÃ³n, como demostraciÃ³n para postulaciÃ³n a puesto backend junior en DataBot (empresa chilena).
Requisitos tÃ©cnicos:

API Ollama 3-8B ya funcional en Hugging Face
Base de datos en Render (PostgreSQL)
Chat en tiempo real con WebSockets
Sistema NLU integrado
Desplegable en servicios gratuitos

ğŸ—ï¸ ARQUITECTURA TÃ‰CNICA
Stack TecnolÃ³gico
Backend: FastAPI + WebSockets + SQLAlchemy
Frontend: Jinja2 templates + HTML/CSS/JS vanilla
Base de datos: PostgreSQL (Render)
IA: Ollama 3-8B via Hugging Face API
Despliegue: Render (todo en uno)
Flujo del Sistema
Usuario â†’ NLU (intenciÃ³n, entidad) â†’ Consulta BD â†’ Contexto/Prompt â†’ LLM â†’ Respuesta â†’ WebSocket â†’ Registro DB
ğŸ—„ï¸ ESQUEMA DE BASE DE DATOS
1. productos
sqlCREATE TABLE productos (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    categoria_id INTEGER REFERENCES categorias(id),
    precio DECIMAL(10,2) NOT NULL,
    descripcion TEXT,
    marca VARCHAR(100),
    stock INTEGER DEFAULT 0,
    activo BOOLEAN DEFAULT TRUE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
2. categorias
sqlCREATE TABLE categorias (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    descripcion TEXT,
    categoria_padre_id INTEGER REFERENCES categorias(id),
    activo BOOLEAN DEFAULT TRUE
);
3. usuarios_sesiones
sqlCREATE TABLE usuarios_sesiones (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) UNIQUE NOT NULL,
    ip_address INET,
    user_agent TEXT,
    fecha_inicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_ultimo_acceso TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    activo BOOLEAN DEFAULT TRUE
);
4. conversaciones
sqlCREATE TABLE conversaciones (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) REFERENCES usuarios_sesiones(session_id),
    mensaje_usuario TEXT NOT NULL,
    respuesta_bot TEXT NOT NULL,
    intencion_detectada VARCHAR(100),
    entidades_extraidas JSONB,
    contexto_bd JSONB,
    tiempo_respuesta_ms INTEGER,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
5. intenciones_detectadas
sqlCREATE TABLE intenciones_detectadas (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) REFERENCES usuarios_sesiones(session_id),
    intencion VARCHAR(100) NOT NULL,
    confianza DECIMAL(3,2),
    entidades JSONB,
    mensaje_original TEXT,
    productos_consultados JSONB,
    resultado_exitoso BOOLEAN,
    fecha_deteccion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
ğŸ§  SISTEMA NLU
Intenciones a Detectar

buscar_producto: Usuario busca producto especÃ­fico
recomendar_categoria: Pide recomendaciones por categorÃ­a
comparar_precios: Quiere comparar precios
info_producto: Solicita informaciÃ³n detallada
saludo: InteracciÃ³n inicial
ayuda: Solicita ayuda o no entiende

Entidades a Extraer

marca: Marca del producto
categoria: CategorÃ­a de producto
rango_precio: Rango de precios (min-max)
caracteristicas: CaracterÃ­sticas especÃ­ficas

ğŸ—ï¸ ESTRUCTURA DEL PROYECTO
/app
â”œâ”€â”€ main.py (FastAPI app + WebSocket endpoints)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py (SQLAlchemy models)
â”‚   â””â”€â”€ schemas.py (Pydantic models)
â”œâ”€â”€ nlu/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ intent_classifier.py (detecciÃ³n intenciones)
â”‚   â””â”€â”€ entity_extractor.py (extracciÃ³n entidades)
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py (configuraciÃ³n DB)
â”‚   â””â”€â”€ queries.py (consultas especÃ­ficas)
â”œâ”€â”€ llm/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ollama_client.py (integraciÃ³n Hugging Face)
â”‚   â””â”€â”€ prompt_builder.py (construcciÃ³n contexto)
â”œâ”€â”€ websocket/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ manager.py (manejo conexiones WebSocket)
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html (chat interface)
â”‚   â””â”€â”€ dashboard.html (mÃ©tricas - opcional)
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/style.css
â”‚   â””â”€â”€ js/chat.js
â””â”€â”€ requirements.txt
ğŸ¯ FUNCIONALIDADES CLAVE
1. Chat en Tiempo Real

Interface web limpia y responsive
WebSockets para mensajerÃ­a instantÃ¡nea
Indicadores de "escribiendo..."
Historial de conversaciÃ³n

2. Procesamiento NLU

DetecciÃ³n automÃ¡tica de intenciones
ExtracciÃ³n de entidades relevantes
Confidence scoring para cada detecciÃ³n
Fallback para intenciones no reconocidas

3. Consultas Inteligentes a BD

Queries dinÃ¡micas basadas en intenciones
Filtros por categorÃ­a, precio, marca
Recomendaciones basadas en similaridad
Manejo de resultados vacÃ­os

4. IntegraciÃ³n LLM

ConstrucciÃ³n de prompts contextualizados
Respuestas naturales con datos especÃ­ficos
Manejo de errores de API
OptimizaciÃ³n de tokens

5. Logging y MÃ©tricas

Registro completo de conversaciones
AnÃ¡lisis de intenciones detectadas
MÃ©tricas de tiempo de respuesta
Tracking de sesiones anÃ³nimas

ğŸš€ PLAN DE DESARROLLO
Fase 1: Setup Base

Configurar FastAPI con WebSockets
Conectar base de datos PostgreSQL
Crear modelos SQLAlchemy
Interface bÃ¡sica de chat

Fase 2: NLU Core

Implementar clasificador de intenciones
Extractor de entidades
Sistema de confidence scoring
Testing con casos de uso

Fase 3: IntegraciÃ³n BD

Queries dinÃ¡micas por intenciÃ³n
Sistema de recomendaciones
Filtros y bÃºsquedas avanzadas
Manejo de casos edge

Fase 4: LLM Integration

Cliente para API Ollama
Constructor de prompts contextualizados
Procesamiento de respuestas
Manejo de errores

Fase 5: ProducciÃ³n

Logging completo
MÃ©tricas y dashboard
OptimizaciÃ³n de performance
Despliegue en Render

ğŸ”§ CONFIGURACIÃ“N TÃ‰CNICA
Variables de Entorno
DATABASE_URL=postgresql://user:pass@host:port/db
OLLAMA_API_URL=https://api-inference.huggingface.co/models/your-model
OLLAMA_API_KEY=your-huggingface-token
DEBUG=True
Dependencias Principales
fastapi
uvicorn
websockets
sqlalchemy
psycopg2-binary
pydantic
jinja2
aiofiles
httpx
python-multipart
ğŸ¯ PUNTOS CLAVE PARA IMPRESIONAR

Sistema NLU personalizado (no solo RAG bÃ¡sico)
MÃ©tricas y logging detallado
Arquitectura escalable y limpia
IntegraciÃ³n completa IA + BD + Frontend
CÃ³digo documentado y profesional
Demo funcional en producciÃ³n